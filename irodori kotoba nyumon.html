<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã„ã‚ã©ã‚Š æ—¥æœ¬èªå˜èªã‚¯ã‚¤ã‚º</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f0f9ff;
        }
        .romaji-font {
            font-family: 'Roboto', sans-serif;
        }
        .emoji-img {
            font-size: 4rem;
            line-height: 1;
        }
        @media (min-width: 768px) {
            .emoji-img {
                font-size: 5rem;
            }
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .btn-answer:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border-color: #38bdf8;
        }
        .btn-answer:active:not(:disabled) {
            transform: scale(0.98);
        }

        .btn-play {
            transition: all 0.2s;
        }
        .btn-play:hover {
            transform: scale(1.1);
            background-color: #0ea5e9;
            color: white;
        }
        .btn-play:active {
            transform: scale(0.9);
        }

        .correct-anim {
            background-color: #dcfce7 !important;
            border-color: #22c55e !important;
            color: #14532d !important;
        }
        .wrong-anim {
            background-color: #fee2e2 !important;
            border-color: #ef4444 !important;
            color: #7f1d1d !important;
        }
        
        /* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆè¡¨ç¤º */
        .mora {
            display: inline-block;
            position: relative;
            padding-top: 6px;
        }
        .pitch-high {
            border-top: 3px solid #ef4444; /* èµ¤ç·š */
            color: #ef4444;
        }
        .pitch-drop::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 2px;
            height: 10px; /* ä¸‹ãŒã‚Šç›®ã®ç¸¦ç·š */
            background-color: #ef4444;
        }
        .pitch-low {
            color: #64748b;
        }
        
        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div class="bg-white rounded-2xl shadow-xl w-full max-w-2xl overflow-hidden min-h-[600px] flex flex-col relative">
        
        <!-- Header -->
        <header class="bg-sky-500 p-4 text-white text-center flex items-center justify-between relative shadow-md z-10">
            <div class="w-8"></div>
            <div>
                <h1 class="text-xl font-bold">ã„ã‚ã©ã‚Š ã“ã¨ã°ãƒ†ã‚¹ãƒˆ</h1>
                <p class="text-xs opacity-90">Irodori Vocabulary Quiz</p>
            </div>
            <!-- Settings Button -->
            <button onclick="quizApp.openSettings()" class="text-white hover:bg-sky-600 p-2 rounded-full transition-colors" title="éŸ³å£°è¨­å®š">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.077-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.396-1.622a15.995 15.995 0 00-3.396-1.622m0 0a15.998 15.998 0 00-3.388 1.622m3.388 1.622a15.994 15.994 0 01-1.622 3.395m0 0a15.998 15.998 0 003.388 1.62m5.713-7.208a3 3 0 11-5.709-1.085 2.25 2.25 0 01-2.438-2.25 4.5 4.5 0 018.106-2.088c.06.324.09.658.09.998 0 .44-.044.87-.128 1.288zM15 15.75a3 3 0 11-6 0 3 3 0 016 0zm6.367-8.4a3 3 0 11-5.63-1.643 2.25 2.25 0 01-2.28-2.357 4.5 4.5 0 018.426 1.62c0 .878-.204 1.706-.557 2.453l-.007.016a1.65 1.65 0 00.048 1.91z" />
                </svg>
            </button>
        </header>

        <main id="app-content" class="flex-1 p-4 md:p-8 flex flex-col items-center justify-center w-full relative z-0">
            <!-- Dynamic content -->
        </main>

        <footer class="bg-slate-50 p-2 text-center text-xs text-slate-400">
            Based on Irodori Starter Wordlist
        </footer>

        <!-- Settings Modal -->
        <div id="settings-modal" class="absolute inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4 fade-in">
            <div class="bg-white rounded-2xl w-full max-w-sm p-6 shadow-2xl">
                <h3 class="text-lg font-bold text-slate-800 mb-4 border-b pb-2">éŸ³å£°è¨­å®š (Voice Settings)</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-bold text-slate-600 mb-1">å£°ã®ç¨®é¡ (Voice)</label>
                        <select id="voice-select" class="w-full border rounded-lg p-2 text-sm bg-slate-50">
                            <option>èª­ã¿è¾¼ã¿ä¸­...</option>
                        </select>
                        <p class="text-xs text-slate-400 mt-1">â€»Googleã‚„Microsoftã®éŸ³å£°ã‚’é¸ã¶ã¨è‡ªç„¶ã«ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-slate-600 mb-1">é€Ÿã• (Speed): <span id="rate-val">0.8</span></label>
                        <input type="range" id="rate-range" min="0.5" max="1.5" step="0.1" value="0.8" class="w-full accent-sky-500">
                    </div>

                    <button onclick="quizApp.testSpeech()" class="w-full py-2 border border-sky-500 text-sky-500 rounded-lg text-sm font-bold hover:bg-sky-50">
                        ğŸ”Š ãƒ†ã‚¹ãƒˆå†ç”Ÿ (Test)
                    </button>
                </div>

                <div class="mt-6 flex justify-end">
                    <button onclick="quizApp.closeSettings()" class="bg-slate-800 text-white px-6 py-2 rounded-lg font-bold hover:bg-slate-700">
                        é–‰ã˜ã‚‹ (Close)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 1. Menu -->
    <template id="tmpl-menu">
        <div class="w-full space-y-4 fade-in max-w-lg mx-auto h-full flex flex-col">
            <h2 class="text-center text-lg font-bold text-slate-700 mb-4 flex-shrink-0">ç·´ç¿’ã™ã‚‹èª²ã‚’é¸ã‚“ã§ãã ã•ã„<br><span class="text-sm font-normal text-slate-500">Select a lesson to practice</span></h2>
            
            <div class="flex-1 overflow-y-auto pr-2 custom-scrollbar">
                <!-- Comprehensive Review Section -->
                <div class="mb-6">
                    <h3 class="text-sm font-bold text-slate-500 mb-2 px-1">ã¾ã¨ã‚ã¦ãƒ†ã‚¹ãƒˆ (Comprehensive Test)</h3>
                    <div class="grid grid-cols-1 gap-3">
                        <button onclick="quizApp.startQuiz('review-1-6')" class="p-4 rounded-xl border-2 border-violet-100 bg-violet-50 hover:bg-violet-100 hover:border-violet-300 transition-all text-left flex items-center group shadow-sm">
                            <span class="bg-violet-500 text-white rounded-full w-10 h-10 flex-shrink-0 flex items-center justify-center mr-4 font-bold text-sm shadow-md group-hover:scale-110 transition-transform">1-6</span>
                            <div>
                                <div class="font-bold text-slate-700">ç¬¬1èª² ã€œ ç¬¬6èª²</div>
                                <div class="text-xs text-slate-500">ã‚ã„ã•ã¤ã€è‡ªå·±ç´¹ä»‹ã€é£Ÿã¹ç‰©ãªã©</div>
                            </div>
                        </button>
                        <button onclick="quizApp.startQuiz('review-7-12')" class="p-4 rounded-xl border-2 border-violet-100 bg-violet-50 hover:bg-violet-100 hover:border-violet-300 transition-all text-left flex items-center group shadow-sm">
                            <span class="bg-violet-500 text-white rounded-full w-10 h-10 flex-shrink-0 flex items-center justify-center mr-4 font-bold text-sm shadow-md group-hover:scale-110 transition-transform">7-12</span>
                            <div>
                                <div class="font-bold text-slate-700">ç¬¬7èª² ã€œ ç¬¬12èª²</div>
                                <div class="text-xs text-slate-500">å®¶ã€ä»•äº‹ã€æ™‚é–“ã€è¶£å‘³ãªã©</div>
                            </div>
                        </button>
                        <button onclick="quizApp.startQuiz('review-13-18')" class="p-4 rounded-xl border-2 border-violet-100 bg-violet-50 hover:bg-violet-100 hover:border-violet-300 transition-all text-left flex items-center group shadow-sm">
                            <span class="bg-violet-500 text-white rounded-full w-10 h-10 flex-shrink-0 flex items-center justify-center mr-4 font-bold text-sm shadow-md group-hover:scale-110 transition-transform">13-18</span>
                            <div>
                                <div class="font-bold text-slate-700">ç¬¬13èª² ã€œ ç¬¬18èª²</div>
                                <div class="text-xs text-slate-500">ç§»å‹•ã€è²·ã„ç‰©ã€ä¼‘æ—¥ãªã©</div>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Individual Lessons Section -->
                <div>
                    <h3 class="text-sm font-bold text-slate-500 mb-2 px-1">èª²ã”ã¨ã®ç·´ç¿’ (Individual Lessons)</h3>
                    <div class="grid grid-cols-2 gap-3 pb-4" id="lesson-grid">
                        <!-- Lesson Buttons injected here -->
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- 2. Question -->
    <template id="tmpl-question">
        <div class="w-full flex flex-col items-center h-full fade-in justify-start pt-4">
            <div class="w-full bg-slate-100 rounded-full h-2 mb-4 flex-shrink-0">
                <div id="progress-bar" class="bg-sky-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>

            <div class="bg-white flex flex-col items-center mb-6 w-full relative flex-shrink-0">
                <div class="emoji-img mb-2 filter drop-shadow-lg transform transition-transform hover:scale-110 cursor-default" id="q-image">ğŸ</div>
                <div class="text-sm text-slate-500 font-mono border border-slate-200 rounded px-3 py-1 mb-2 bg-slate-50" id="q-hint">English Hint</div>
                <h3 class="text-xl font-bold text-slate-800" id="q-text">ã“ã‚Œã¯ãªã‚“ã§ã™ã‹ï¼Ÿ</h3>
            </div>

            <div class="grid grid-cols-1 gap-3 w-full overflow-y-auto pb-4 custom-scrollbar" id="options-container">
                <!-- Injected via JS -->
            </div>

            <div class="mt-2 text-xs text-slate-400 text-center flex-shrink-0">
                <span class="text-red-500 font-bold border-t-2 border-red-500 inline-block px-1">èµ¤ç·š</span> ã¯éŸ³ã®é«˜ã•ã‚’è¡¨ã—ã¦ã„ã¾ã™
            </div>

            <div id="feedback-area" class="absolute inset-0 bg-white/95 backdrop-blur-sm flex flex-col items-center justify-center z-20 hidden rounded-2xl animate-fade-in p-4">
                <div id="feedback-icon" class="text-6xl mb-4 filter drop-shadow-md">â­•</div>
                <div id="feedback-text" class="text-3xl font-bold mb-2">ã›ã„ã‹ã„ï¼</div>
                
                <div class="text-slate-500 mb-1 text-sm">æ­£è§£ (Answer):</div>
                
                <div class="bg-white px-8 py-6 rounded-xl border-2 border-sky-100 shadow-sm mb-6 flex flex-col items-center justify-center min-w-[200px]">
                    <div id="feedback-correct-answer" class="text-3xl font-bold flex flex-row flex-wrap justify-center items-end gap-x-1 mb-2">
                        <!-- HTML Accent -->
                    </div>
                    <div id="feedback-romaji" class="text-lg text-slate-500 font-bold romaji-font">
                        <!-- Romaji -->
                    </div>
                </div>

                <button onclick="quizApp.nextQuestion()" class="bg-slate-800 text-white text-lg font-bold py-3 px-12 rounded-full shadow-xl transition-transform hover:scale-105 active:scale-95 flex items-center">
                    ã¤ãã¸ <span class="ml-2">ğŸ‘‰</span>
                </button>
            </div>
        </div>
    </template>

    <!-- 3. Result -->
    <template id="tmpl-result">
        <div class="flex flex-col items-center justify-center w-full h-full text-center space-y-6 fade-in">
            <div class="text-7xl animate-bounce">ğŸ‰</div>
            <div>
                <h2 class="text-2xl font-bold text-slate-800 mb-2">ãŠã¤ã‹ã‚Œã•ã¾ã§ã—ãŸï¼</h2>
                <p class="text-slate-500">ãƒ†ã‚¹ãƒˆã—ã‚…ã†ã‚Šã‚‡ã† (Finished)</p>
            </div>
            
            <div class="bg-sky-50 rounded-2xl p-8 w-full max-w-xs border border-sky-100 shadow-inner">
                <div class="text-sm text-sky-600 mb-1">ã‚¹ã‚³ã‚¢ (Score)</div>
                <div class="text-5xl font-bold text-sky-600 mb-3 tracking-tighter">
                    <span id="score-num">0</span><span class="text-2xl text-sky-400 mx-2">/</span><span id="total-num">0</span>
                </div>
                <div id="score-message" class="text-base font-bold text-sky-700 bg-sky-100 py-1 px-3 rounded-full inline-block">Good Job!</div>
            </div>

            <!-- Retry Wrong Questions Button (Conditional) -->
            <div id="retry-container" class="hidden w-full max-w-xs">
                <button onclick="quizApp.retryWrong()" class="w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform hover:scale-105 flex items-center justify-center mb-4">
                    <span class="mr-2">ğŸ”„</span> é–“é•ãˆãŸå•é¡Œã‚’å¾©ç¿’ã™ã‚‹
                </button>
            </div>

            <button onclick="quizApp.init()" class="bg-slate-700 hover:bg-slate-800 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform hover:scale-105 flex items-center">
                <span class="mr-2">ğŸ </span> ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚‚ã©ã‚‹
            </button>
        </div>
    </template>

    <script>
        const vocabData = {
            '1': [
                { word: 'ãŠã¯ã‚ˆã†', reading: 'ãŠã¯ã‚ˆã†', romaji: 'Ohayou', accent: 3, english: 'Good morning', emoji: 'â˜€ï¸' },
                { word: 'ã“ã‚“ã«ã¡ã¯', reading: 'ã“ã‚“ã«ã¡ã¯', romaji: 'Konnichiwa', accent: 0, english: 'Good afternoon', emoji: 'ğŸ‘‹' },
                { word: 'ã“ã‚“ã°ã‚“ã¯', reading: 'ã“ã‚“ã°ã‚“ã¯', romaji: 'Konbanwa', accent: 0, english: 'Good evening', emoji: 'ğŸŒ™' },
                { word: 'ã•ã‚ˆã†ãªã‚‰', reading: 'ã•ã‚ˆã†ãªã‚‰', romaji: 'Sayounara', accent: 5, english: 'Goodbye', emoji: 'ğŸ‘‹' },
                { word: 'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™', reading: 'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™', romaji: 'Arigatou gozaimasu', accent: 2, english: 'Thank you', emoji: 'ğŸ™' },
                { word: 'ã™ã¿ã¾ã›ã‚“', reading: 'ã™ã¿ã¾ã›ã‚“', romaji: 'Sumimasen', accent: 4, english: 'Excuse me / Sorry', emoji: 'ğŸ™‡' },
                { word: 'ã¯ã„', reading: 'ã¯ã„', romaji: 'Hai', accent: 1, english: 'Yes', emoji: 'â­•' },
                { word: 'ã„ã„ãˆ', reading: 'ã„ã„ãˆ', romaji: 'Iie', accent: 3, english: 'No', emoji: 'âŒ' },
                { word: 'ãŠã•ãã« ã—ã¤ã‚Œã„ã—ã¾ã™', reading: 'ãŠã•ãã« ã—ã¤ã‚Œã„ã—ã¾ã™', romaji: 'Osakini shitsureeshimasu', accent: 0, english: 'I\'m leaving before you', emoji: 'ğŸšª' },
                { word: 'ãŠã¤ã‹ã‚Œã•ã¾ã§ã—ãŸ', reading: 'ãŠã¤ã‹ã‚Œã•ã¾ã§ã—ãŸ', romaji: 'Otsukaresama deshita', accent: 0, english: 'Good work / Goodbye (to colleague)', emoji: 'ğŸµ' },
                { word: 'ãŠã­ãŒã„ã—ã¾ã™', reading: 'ãŠã­ãŒã„ã—ã¾ã™', romaji: 'Onegaishimasu', accent: 6, english: 'Please', emoji: 'ğŸ™' },
                { word: 'ã©ã†ã„ãŸã—ã¾ã—ã¦', reading: 'ã©ã†ã„ãŸã—ã¾ã—ã¦', romaji: 'Douitashimashite', accent: 0, english: 'You\'re welcome', emoji: 'ğŸ’' }
            ],
            '2': [
                { word: '0', reading: 'ã‚¼ãƒ­', romaji: 'Zero', accent: 1, english: 'Zero', emoji: '0ï¸âƒ£' },
                { word: '1', reading: 'ã„ã¡', romaji: 'Ichi', accent: 2, english: 'One', emoji: '1ï¸âƒ£' },
                { word: '2', reading: 'ã«', romaji: 'Ni', accent: 1, english: 'Two', emoji: '2ï¸âƒ£' },
                { word: '3', reading: 'ã•ã‚“', romaji: 'San', accent: 0, english: 'Three', emoji: '3ï¸âƒ£' },
                { word: '4', reading: 'ã‚ˆã‚“', romaji: 'Yon', accent: 1, english: 'Four', emoji: '4ï¸âƒ£' },
                { word: '5', reading: 'ã”', romaji: 'Go', accent: 1, english: 'Five', emoji: '5ï¸âƒ£' },
                { word: '6', reading: 'ã‚ã', romaji: 'Roku', accent: 2, english: 'Six', emoji: '6ï¸âƒ£' },
                { word: '7', reading: 'ãªãª', romaji: 'Nana', accent: 1, english: 'Seven', emoji: '7ï¸âƒ£' },
                { word: '8', reading: 'ã¯ã¡', romaji: 'Hachi', accent: 1, english: 'Eight', emoji: '8ï¸âƒ£' },
                { word: '9', reading: 'ãã‚…ã†', romaji: 'Kyuu', accent: 1, english: 'Nine', emoji: '9ï¸âƒ£' },
                { word: '10', reading: 'ã˜ã‚…ã†', romaji: 'Juu', accent: 1, english: 'Ten', emoji: 'ğŸ”Ÿ' },
                { word: 'ã›ã‚“ã›ã„', reading: 'ã›ã‚“ã›ã„', romaji: 'Sensei', accent: 3, english: 'Teacher', emoji: 'ğŸ‘©â€ğŸ«' },
                { word: 'ãŒãã›ã„', reading: 'ãŒãã›ã„', romaji: 'Gakusei', accent: 0, english: 'Student', emoji: 'ğŸ‘¨â€ğŸ“' },
                { word: 'ã»ã‚“', reading: 'ã»ã‚“', romaji: 'Hon', accent: 1, english: 'Book', emoji: 'ğŸ“•' },
                { word: 'ã¿ã¦ ãã ã•ã„', reading: 'ã¿ã¦ ãã ã•ã„', romaji: 'Mite kudasai', accent: 1, english: 'Please look', emoji: 'ğŸ‘€' },
                { word: 'ãã„ã¦ ãã ã•ã„', reading: 'ãã„ã¦ ãã ã•ã„', romaji: 'Kiite kudasai', accent: 1, english: 'Please listen', emoji: 'ğŸ‘‚' },
                { word: 'ã‚ˆã‚“ã§ ãã ã•ã„', reading: 'ã‚ˆã‚“ã§ ãã ã•ã„', romaji: 'Yonde kudasai', accent: 1, english: 'Please read', emoji: 'ğŸ“–' },
                { word: 'ã‹ã„ã¦ ãã ã•ã„', reading: 'ã‹ã„ã¦ ãã ã•ã„', romaji: 'Kaite kudasai', accent: 1, english: 'Please write', emoji: 'âœï¸' },
                { word: 'ã„ã£ã¦ ãã ã•ã„', reading: 'ã„ã£ã¦ ãã ã•ã„', romaji: 'Itte kudasai', accent: 1, english: 'Please say it', emoji: 'ğŸ—£ï¸' },
                { word: 'ã‚‚ã†ã„ã¡ã©', reading: 'ã‚‚ã†ã„ã¡ã©', romaji: 'Mou ichido', accent: 3, english: 'Once more', emoji: 'ğŸ”' },
                { word: 'ã‚†ã£ãã‚Š', reading: 'ã‚†ã£ãã‚Š', romaji: 'Yukkuri', accent: 3, english: 'Slowly', emoji: 'ğŸ¢' },
                { word: 'ã‚ã‹ã‚Šã¾ã—ãŸ', reading: 'ã‚ã‹ã‚Šã¾ã—ãŸ', romaji: 'Wakarimashita', accent: 4, english: 'I understand', emoji: 'ğŸ’¡' },
                { word: 'ã‚ã‹ã‚Šã¾ã›ã‚“', reading: 'ã‚ã‹ã‚Šã¾ã›ã‚“', romaji: 'Wakarimasen', accent: 4, english: 'I don\'t understand', emoji: 'â“' }
            ],
            '3': [
                { word: 'ã‚ãŸã—', reading: 'ã‚ãŸã—', romaji: 'Watashi', accent: 0, english: 'I / Me', emoji: 'ğŸ™‹' },
                { word: 'ãã«', reading: 'ãã«', romaji: 'Kuni', accent: 0, english: 'Country', emoji: 'ğŸŒ' },
                { word: 'ãªã¾ãˆ', reading: 'ãªã¾ãˆ', romaji: 'Namae', accent: 0, english: 'Name', emoji: 'ğŸ“›' },
                { word: 'ã—ã”ã¨', reading: 'ã—ã”ã¨', romaji: 'Shigoto', accent: 0, english: 'Job / Work', emoji: 'ğŸ’¼' },
                { word: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢', reading: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢', romaji: 'Enjinia', accent: 3, english: 'Engineer', emoji: 'ğŸ‘·' },
                { word: 'ã‹ã„ã—ã‚ƒã„ã‚“', reading: 'ã‹ã„ã—ã‚ƒã„ã‚“', romaji: 'Kaishain', accent: 3, english: 'Company employee', emoji: 'ğŸ¢' },
                { word: 'ãŒãã›ã„', reading: 'ãŒãã›ã„', romaji: 'Gakusei', accent: 0, english: 'Student', emoji: 'ğŸ“' },
                { word: 'å…¬å‹™å“¡', reading: 'ã“ã†ã‚€ã„ã‚“', romaji: 'Koumuin', accent: 3, english: 'Public servant', emoji: 'ğŸ›ï¸' },
                { word: 'ä¸»å©¦', reading: 'ã—ã‚…ãµ', romaji: 'Shufu', accent: 1, english: 'Homemaker', emoji: 'ğŸ ' },
                { word: 'ã¯ã˜ã‚ã¾ã—ã¦', reading: 'ã¯ã˜ã‚ã¾ã—ã¦', romaji: 'Hajimemashite', accent: 4, english: 'Nice to meet you', emoji: 'ğŸ¤' },
                { word: 'ã©ã†ã ã‚ˆã‚ã—ã', reading: 'ã©ã†ã ã‚ˆã‚ã—ã', romaji: 'Douzo yoroshiku', accent: 1, english: 'Nice to meet you (closing)', emoji: 'ğŸ™‡' },
                { word: 'ã“ã¡ã‚‰ã“ã', reading: 'ã“ã¡ã‚‰ã“ã', romaji: 'Kochirakoso', accent: 0, english: 'Nice to meet you too', emoji: 'â˜ºï¸' }
            ],
            '4': [
                { word: 'ã‹ãã', reading: 'ã‹ãã', romaji: 'Kazoku', accent: 1, english: 'Family', emoji: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦' },
                { word: 'ã¡ã¡', reading: 'ã¡ã¡', romaji: 'Chichi', accent: 2, english: 'Father (my)', emoji: 'ğŸ‘¨' },
                { word: 'ã¯ã¯', reading: 'ã¯ã¯', romaji: 'Haha', accent: 1, english: 'Mother (my)', emoji: 'ğŸ‘©' },
                { word: 'ã‚ã«', reading: 'ã‚ã«', romaji: 'Ani', accent: 1, english: 'Older brother (my)', emoji: 'ğŸ‘¦' },
                { word: 'ã‚ã­', reading: 'ã‚ã­', romaji: 'Ane', accent: 0, english: 'Older sister (my)', emoji: 'ğŸ‘§' },
                { word: 'ãŠã¨ã†ã¨', reading: 'ãŠã¨ã†ã¨', romaji: 'Otouto', accent: 4, english: 'Younger brother (my)', emoji: 'ğŸ‘¶' },
                { word: 'ã„ã‚‚ã†ã¨', reading: 'ã„ã‚‚ã†ã¨', romaji: 'Imouto', accent: 4, english: 'Younger sister (my)', emoji: 'ğŸ§’' },
                { word: 'ãŠã£ã¨', reading: 'ãŠã£ã¨', romaji: 'Otto', accent: 0, english: 'Husband (my)', emoji: 'ğŸ¤µ' },
                { word: 'ã¤ã¾', reading: 'ã¤ã¾', romaji: 'Tsuma', accent: 1, english: 'Wife (my)', emoji: 'ğŸ‘°' },
                { word: 'ã“ã©ã‚‚', reading: 'ã“ã©ã‚‚', romaji: 'Kodomo', accent: 0, english: 'Child', emoji: 'ğŸ§’' },
                { word: 'ã ã‚Œ', reading: 'ã ã‚Œ', romaji: 'Dare', accent: 1, english: 'Who', emoji: 'ğŸ‘¤' },
                { word: 'ã²ã¨ã‚Š', reading: 'ã²ã¨ã‚Š', romaji: 'Hitori', accent: 2, english: 'One person (alone)', emoji: 'ğŸ‘¤' },
                { word: 'ãµãŸã‚Š', reading: 'ãµãŸã‚Š', romaji: 'Futari', accent: 3, english: 'Two people', emoji: 'ğŸ‘¥' },
                { word: 'ãªã‚“ã«ã‚“', reading: 'ãªã‚“ã«ã‚“', romaji: 'Nannin', accent: 1, english: 'How many people', emoji: 'ğŸ”¢' },
                { word: 'ã•ã„', reading: 'ã•ã„', romaji: '-sai', accent: 1, english: '...years old', emoji: 'ğŸ‚' },
                { word: 'ãªã‚“ã•ã„', reading: 'ãªã‚“ã•ã„', romaji: 'Nansai', accent: 1, english: 'How old', emoji: 'â“' },
                { word: 'ã„ã£ã•ã„', reading: 'ã„ã£ã•ã„', romaji: 'Issai', accent: 1, english: '1 year old', emoji: '1ï¸âƒ£ğŸ‚' },
                { word: 'ã¯ã£ã•ã„', reading: 'ã¯ã£ã•ã„', romaji: 'Hassai', accent: 1, english: '8 years old', emoji: '8ï¸âƒ£ğŸ‚' },
                { word: 'ã˜ã‚…ã£ã•ã„', reading: 'ã˜ã‚…ã£ã•ã„', romaji: 'Jussai', accent: 1, english: '10 years old', emoji: 'ğŸ”ŸğŸ‚' },
                { word: 'ã¯ãŸã¡', reading: 'ã¯ãŸã¡', romaji: 'Hatachi', accent: 1, english: '20 years old', emoji: 'ğŸ‰' },
                { word: 'ãƒšãƒƒãƒˆ', reading: 'ãƒšãƒƒãƒˆ', romaji: 'Petto', accent: 1, english: 'Pet', emoji: 'ğŸ•' }
            ],
            '5': [
                { word: 'ãŸã¹ã‚‚ã®', reading: 'ãŸã¹ã‚‚ã®', romaji: 'Tabemono', accent: 2, english: 'Food', emoji: 'ğŸ±' },
                { word: 'ã®ã¿ã‚‚ã®', reading: 'ã®ã¿ã‚‚ã®', romaji: 'Nomimono', accent: 2, english: 'Drink', emoji: 'ğŸ¹' },
                { word: 'ã«ã', reading: 'ã«ã', romaji: 'Niku', accent: 2, english: 'Meat', emoji: 'ğŸ–' },
                { word: 'ã•ã‹ãª', reading: 'ã•ã‹ãª', romaji: 'Sakana', accent: 0, english: 'Fish', emoji: 'ğŸŸ' },
                { word: 'ã‚„ã•ã„', reading: 'ã‚„ã•ã„', romaji: 'Yasai', accent: 0, english: 'Vegetable', emoji: 'ğŸ¥¦' },
                { word: 'ãã ã‚‚ã®', reading: 'ãã ã‚‚ã®', romaji: 'Kudamono', accent: 2, english: 'Fruit', emoji: 'ğŸ' },
                { word: 'ãŸã¾ã”', reading: 'ãŸã¾ã”', romaji: 'Tamago', accent: 2, english: 'Egg', emoji: 'ğŸ¥š' },
                { word: 'ã¿ãš', reading: 'ã¿ãš', romaji: 'Mizu', accent: 0, english: 'Water', emoji: 'ğŸ’§' },
                { word: 'ãŠã¡ã‚ƒ', reading: 'ãŠã¡ã‚ƒ', romaji: 'Ocha', accent: 0, english: 'Tea', emoji: 'ğŸµ' },
                { word: 'ã‚³ãƒ¼ãƒ’ãƒ¼', reading: 'ã‚³ãƒ¼ãƒ’ãƒ¼', romaji: 'Koohii', accent: 3, english: 'Coffee', emoji: 'â˜•' },
                { word: 'ãƒ‘ãƒ³', reading: 'ãƒ‘ãƒ³', romaji: 'Pan', accent: 1, english: 'Bread', emoji: 'ğŸ' },
                { word: 'ã‚ã•ã”ã¯ã‚“', reading: 'ã‚ã•ã”ã¯ã‚“', romaji: 'Asagohan', accent: 3, english: 'Breakfast', emoji: 'ğŸ¥£' },
                { word: 'ã²ã‚‹ã”ã¯ã‚“', reading: 'ã²ã‚‹ã”ã¯ã‚“', romaji: 'Hirugohan', accent: 3, english: 'Lunch', emoji: 'ğŸ±' },
                { word: 'ã°ã‚“ã”ã¯ã‚“', reading: 'ã°ã‚“ã”ã¯ã‚“', romaji: 'Bangohan', accent: 3, english: 'Dinner', emoji: 'ğŸ²' },
                { word: 'ã™ã', reading: 'ã™ã', romaji: 'Suki', accent: 2, english: 'Like', emoji: 'â¤ï¸' },
                { word: 'ãã‚‰ã„', reading: 'ãã‚‰ã„', romaji: 'Kirai', accent: 0, english: 'Dislike', emoji: 'ğŸ’”' },
                { word: 'ãŠã„ã—ã„', reading: 'ãŠã„ã—ã„', romaji: 'Oishii', accent: 3, english: 'Delicious', emoji: 'ğŸ˜‹' }
            ],
            '6': [
                { word: 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼', reading: 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼', romaji: 'Menyuu', accent: 1, english: 'Menu', emoji: 'ğŸ“œ' },
                { word: 'ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼', reading: 'ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼', romaji: 'Hanbaagaa', accent: 3, english: 'Hamburger', emoji: 'ğŸ”' },
                { word: 'ãƒãƒ¼ã‚ºãƒãƒ¼ã‚¬ãƒ¼', reading: 'ãƒãƒ¼ã‚ºãƒãƒ¼ã‚¬ãƒ¼', romaji: 'Chiizubaagaa', accent: 4, english: 'Cheeseburger', emoji: 'ğŸ§€' },
                { word: 'ãƒ‰ãƒªãƒ³ã‚¯', reading: 'ãƒ‰ãƒªãƒ³ã‚¯', romaji: 'Dorinku', accent: 0, english: 'Drink', emoji: 'ğŸ¥¤' },
                { word: 'ãƒãƒ†ãƒˆ', reading: 'ãƒãƒ†ãƒˆ', romaji: 'Poteto', accent: 0, english: 'French fries', emoji: 'ğŸŸ' },
                { word: 'ã‚³ãƒ¼ãƒ©', reading: 'ã‚³ãƒ¼ãƒ©', romaji: 'Koora', accent: 1, english: 'Cola', emoji: 'ğŸ¥¤' },
                { word: 'ã‚µã‚¤ã‚º', reading: 'ã‚µã‚¤ã‚º', romaji: 'Saizu', accent: 1, english: 'Size', emoji: 'ğŸ“' },
                { word: 'ã²ã¨ã¤', reading: 'ã²ã¨ã¤', romaji: 'Hitotsu', accent: 2, english: 'One (item)', emoji: '1ï¸âƒ£' },
                { word: 'ãµãŸã¤', reading: 'ãµãŸã¤', romaji: 'Futatsu', accent: 3, english: 'Two (items)', emoji: '2ï¸âƒ£' },
                { word: 'ã¿ã£ã¤', reading: 'ã¿ã£ã¤', romaji: 'Mittsu', accent: 3, english: 'Three (items)', emoji: '3ï¸âƒ£' },
                { word: 'ã‚ˆã£ã¤', reading: 'ã‚ˆã£ã¤', romaji: 'Yottsu', accent: 3, english: 'Four (items)', emoji: '4ï¸âƒ£' },
                { word: 'ãã ã•ã„', reading: 'ãã ã•ã„', romaji: 'Kudasai', accent: 3, english: 'Please give me', emoji: 'ğŸ¤²' },
                { word: 'ã„ã–ã‹ã‚„', reading: 'ã„ã–ã‹ã‚„', romaji: 'Izakaya', accent: 0, english: 'Izakaya (Japanese pub)', emoji: 'ğŸ®' },
                { word: 'ãˆã ã¾ã‚', reading: 'ãˆã ã¾ã‚', romaji: 'Edamame', accent: 0, english: 'Edamame', emoji: 'ğŸ«›' },
                { word: 'ã‹ã‚‰ã‚ã’', reading: 'ã‹ã‚‰ã‚ã’', romaji: 'Karaage', accent: 0, english: 'Fried chicken', emoji: 'ğŸ—' },
                { word: 'ç”Ÿãƒ“ãƒ¼ãƒ«', reading: 'ãªã¾ãƒ“ãƒ¼ãƒ«', romaji: 'Namabiiru', accent: 3, english: 'Draft beer', emoji: 'ğŸº' }
            ],
            '7': [
                { word: 'ã„ãˆ', reading: 'ã„ãˆ', romaji: 'Ie', accent: 2, english: 'House / Home', emoji: 'ğŸ ' },
                { word: 'ã¸ã‚„', reading: 'ã¸ã‚„', romaji: 'Heya', accent: 2, english: 'Room', emoji: 'ğŸšª' },
                { word: 'ãƒˆã‚¤ãƒ¬', reading: 'ãƒˆã‚¤ãƒ¬', romaji: 'Toire', accent: 1, english: 'Toilet', emoji: 'ğŸš½' },
                { word: 'ãŠãµã‚', reading: 'ãŠãµã‚', romaji: 'Ofuro', accent: 2, english: 'Bath', emoji: 'ğŸ›' },
                { word: 'ã ã„ã©ã“ã‚', reading: 'ã ã„ã©ã“ã‚', romaji: 'Daidokoro', accent: 0, english: 'Kitchen', emoji: 'ğŸ³' },
                { word: 'ã‚¨ã‚¢ã‚³ãƒ³', reading: 'ã‚¨ã‚¢ã‚³ãƒ³', romaji: 'Eakon', accent: 0, english: 'Air conditioner', emoji: 'â„ï¸' },
                { word: 'ãƒ†ãƒ¬ãƒ“', reading: 'ãƒ†ãƒ¬ãƒ“', romaji: 'Terebi', accent: 1, english: 'TV', emoji: 'ğŸ“º' },
                { word: 'ãƒ™ãƒƒãƒ‰', reading: 'ãƒ™ãƒƒãƒ‰', romaji: 'Beddo', accent: 1, english: 'Bed', emoji: 'ğŸ›ï¸' },
                { word: 'ã„ã¾', reading: 'ã„ã¾', romaji: 'Ima', accent: 1, english: 'Living room', emoji: 'ğŸ›‹ï¸' },
                { word: 'Wi-Fi', reading: 'ãƒ¯ã‚¤ãƒ•ã‚¡ã‚¤', romaji: 'Waifai', accent: 3, english: 'Wi-Fi', emoji: 'ğŸ“¶' },
                { word: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰', reading: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰', romaji: 'Pasuwaado', accent: 3, english: 'Password', emoji: 'ğŸ”‘' },
                { word: 'ã©ã†ã', reading: 'ã©ã†ã', romaji: 'Douzo', accent: 1, english: 'Please (enter)', emoji: 'ğŸ’' },
                { word: 'ãŠã˜ã‚ƒã¾ã—ã¾ã™', reading: 'ãŠã˜ã‚ƒã¾ã—ã¾ã™', romaji: 'Ojamashimasu', accent: 6, english: 'Excuse me (entering)', emoji: 'ğŸ‘Ÿ' }
            ],
            '8': [
                { word: 'ã‹ã„ã—ã‚ƒ', reading: 'ã‹ã„ã—ã‚ƒ', romaji: 'Kaisha', accent: 0, english: 'Company', emoji: 'ğŸ¢' },
                { word: 'ã†ã‘ã¤ã‘', reading: 'ã†ã‘ã¤ã‘', romaji: 'Uketsuke', accent: 0, english: 'Reception', emoji: 'ğŸ’' },
                { word: 'ã˜ã‚€ã—ã‚‡', reading: 'ã˜ã‚€ã—ã‚‡', romaji: 'Jimusho', accent: 2, english: 'Office', emoji: 'ğŸ–¨ï¸' },
                { word: 'ã‹ã„ãã—ã¤', reading: 'ã‹ã„ãã—ã¤', romaji: 'Kaigishitsu', accent: 3, english: 'Meeting room', emoji: 'ğŸ—£ï¸' },
                { word: 'ã—ã‚‡ãã©ã†', reading: 'ã—ã‚‡ãã©ã†', romaji: 'Shokudou', accent: 0, english: 'Cafeteria', emoji: 'ğŸ½ï¸' },
                { word: 'ãƒ­ãƒƒã‚«ãƒ¼', reading: 'ãƒ­ãƒƒã‚«ãƒ¼', romaji: 'Rokkaa', accent: 1, english: 'Locker', emoji: 'ğŸ”’' },
                { word: 'ã¤ããˆ', reading: 'ã¤ããˆ', romaji: 'Tsukue', accent: 0, english: 'Desk', emoji: 'ğŸ–¥ï¸' },
                { word: 'ã„ã™', reading: 'ã„ã™', romaji: 'Isu', accent: 0, english: 'Chair', emoji: 'ğŸª‘' },
                { word: 'ã©ã“', reading: 'ã©ã“', romaji: 'Doko', accent: 1, english: 'Where', emoji: 'â“' },
                { word: 'ã“ã“', reading: 'ã“ã“', romaji: 'Koko', accent: 0, english: 'Here', emoji: 'ğŸ‘‡' },
                { word: 'ãã“', reading: 'ãã“', romaji: 'Soko', accent: 0, english: 'There', emoji: 'ğŸ‘‰' },
                { word: 'ã‚ãã“', reading: 'ã‚ãã“', romaji: 'Asoko', accent: 0, english: 'Over there', emoji: 'ğŸ‘‰' }
            ],
            '9': [
                { word: 'ã„ã¾', reading: 'ã„ã¾', romaji: 'Ima', accent: 1, english: 'Now', emoji: 'â±ï¸' },
                { word: 'ã˜', reading: 'ã˜', romaji: '-ji', accent: 1, english: '...o\'clock', emoji: 'ğŸ•’' },
                { word: 'ã¯ã‚“', reading: 'ã¯ã‚“', romaji: 'Han', accent: 1, english: 'Half (past)', emoji: 'ğŸŒ—' },
                { word: 'ãŠãã¾ã™', reading: 'ãŠãã¾ã™', romaji: 'Okimasu', accent: 3, english: 'Wake up', emoji: 'ğŸ¥±' },
                { word: 'ã­ã¾ã™', reading: 'ã­ã¾ã™', romaji: 'Nemasu', accent: 2, english: 'Sleep', emoji: 'ğŸ˜´' },
                { word: 'ã¯ãŸã‚‰ãã¾ã™', reading: 'ã¯ãŸã‚‰ãã¾ã™', romaji: 'Hatarakimasu', accent: 5, english: 'Work', emoji: 'ğŸ› ï¸' },
                { word: 'ã‚„ã™ã¿ã¾ã™', reading: 'ã‚„ã™ã¿ã¾ã™', romaji: 'Yasumimasu', accent: 4, english: 'Rest / Take a break', emoji: 'â˜•' },
                { word: 'ã¹ã‚“ãã‚‡ã†ã—ã¾ã™', reading: 'ã¹ã‚“ãã‚‡ã†ã—ã¾ã™', romaji: 'Benkyoushimasu', accent: 0, english: 'Study', emoji: 'ğŸ“š' },
                { word: 'ãªã‚“ã˜', reading: 'ãªã‚“ã˜', romaji: 'Nanji', accent: 1, english: 'What time', emoji: 'ğŸ•°ï¸' },
                { word: 'ã€œã‹ã‚‰ã€œã¾ã§', reading: 'ã‹ã‚‰ ã¾ã§', romaji: '...kara ...made', accent: 1, english: 'From ... to ...', emoji: 'â†”ï¸' },
                { word: 'ã”ãœã‚“', reading: 'ã”ãœã‚“', romaji: 'Gozen', accent: 1, english: 'AM', emoji: 'â˜€ï¸' },
                { word: 'ã”ã”', reading: 'ã”ã”', romaji: 'Gogo', accent: 1, english: 'PM', emoji: 'ğŸŒ™' }
            ],
            '10': [
                { word: 'ãƒšãƒ³', reading: 'ãƒšãƒ³', romaji: 'Pen', accent: 1, english: 'Pen', emoji: 'ğŸ–Šï¸' },
                { word: 'ãƒ›ãƒƒãƒã‚­ã‚¹', reading: 'ãƒ›ãƒƒãƒã‚­ã‚¹', romaji: 'Hotchikisu', accent: 1, english: 'Stapler', emoji: 'ğŸ“' },
                { word: 'ã¯ã•ã¿', reading: 'ã¯ã•ã¿', romaji: 'Hasami', accent: 2, english: 'Scissors', emoji: 'âœ‚ï¸' },
                { word: 'ã®ã‚Š', reading: 'ã®ã‚Š', romaji: 'Nori', accent: 2, english: 'Glue', emoji: 'ğŸ§´' },
                { word: 'ã‚¹ãƒãƒ›', reading: 'ã‚¹ãƒãƒ›', romaji: 'Sumaho', accent: 0, english: 'Smartphone', emoji: 'ğŸ“±' },
                { word: 'ã‹ã—ã¾ã™', reading: 'ã‹ã—ã¾ã™', romaji: 'Kashimasu', accent: 3, english: 'Lend', emoji: 'ğŸ¤²' },
                { word: 'ã‹ã‚Šã¾ã™', reading: 'ã‹ã‚Šã¾ã™', romaji: 'Karimasu', accent: 3, english: 'Borrow', emoji: 'ğŸ™' },
                { word: 'ã„ã„ã§ã™ã‹', reading: 'ã„ã„ã§ã™ã‹', romaji: 'Ii desuka', accent: 1, english: 'Is it okay?', emoji: 'ğŸ†—' },
                { word: 'ã©ã†ã', reading: 'ã©ã†ã', romaji: 'Douzo', accent: 1, english: 'Here you go / Go ahead', emoji: 'ğŸ’' },
                { word: 'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™', reading: 'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™', romaji: 'Arigatou gozaimasu', accent: 2, english: 'Thank you', emoji: 'ğŸ™' },
                { word: 'ã‚ã‚Šã¾ã™', reading: 'ã‚ã‚Šã¾ã™', romaji: 'Arimasu', accent: 3, english: 'Have / Exist', emoji: 'ğŸ“¦' }
            ],
            '11': [
                { word: 'ã—ã‚…ã¿', reading: 'ã—ã‚…ã¿', romaji: 'Shumi', accent: 1, english: 'Hobby', emoji: 'ğŸ¨' },
                { word: 'ã‚¹ãƒãƒ¼ãƒ„', reading: 'ã‚¹ãƒãƒ¼ãƒ„', romaji: 'Supootsu', accent: 2, english: 'Sports', emoji: 'ğŸ…' },
                { word: 'ã‚µãƒƒã‚«ãƒ¼', reading: 'ã‚µãƒƒã‚«ãƒ¼', romaji: 'Sakkaa', accent: 1, english: 'Soccer', emoji: 'âš½' },
                { word: 'ã‚¸ãƒ§ã‚®ãƒ³ã‚°', reading: 'ã‚¸ãƒ§ã‚®ãƒ³ã‚°', romaji: 'Jogingu', accent: 0, english: 'Jogging', emoji: 'ğŸƒ' },
                { word: 'ã‚¢ãƒ‹ãƒ¡', reading: 'ã‚¢ãƒ‹ãƒ¡', romaji: 'Anime', accent: 1, english: 'Anime', emoji: 'ğŸ“º' },
                { word: 'ãƒãƒ³ã‚¬', reading: 'ãƒãƒ³ã‚¬', romaji: 'Manga', accent: 0, english: 'Manga', emoji: 'ğŸ“š' },
                { word: 'ãˆã„ãŒ', reading: 'ãˆã„ãŒ', romaji: 'Eiga', accent: 1, english: 'Movie', emoji: 'ğŸ¬' },
                { word: 'ãŠã‚“ãŒã', reading: 'ãŠã‚“ãŒã', romaji: 'Ongaku', accent: 1, english: 'Music', emoji: 'ğŸµ' },
                { word: 'ã‚Šã‚‡ã†ã‚Š', reading: 'ã‚Šã‚‡ã†ã‚Š', romaji: 'Ryouri', accent: 1, english: 'Cooking', emoji: 'ğŸ³' },
                { word: 'ã©ãã—ã‚‡', reading: 'ã©ãã—ã‚‡', romaji: 'Dokusho', accent: 1, english: 'Reading', emoji: 'ğŸ“–' },
                { word: 'ã©ã‚“ãª', reading: 'ã©ã‚“ãª', romaji: 'Donna', accent: 1, english: 'What kind of', emoji: 'â“' }
            ],
            '12': [
                { word: 'ã„ã£ã—ã‚‡ã«', reading: 'ã„ã£ã—ã‚‡ã«', romaji: 'Isshoni', accent: 0, english: 'Together', emoji: 'ğŸ‘¥' },
                { word: 'ã”ã¯ã‚“', reading: 'ã”ã¯ã‚“', romaji: 'Gohan', accent: 1, english: 'Meal / Rice', emoji: 'ğŸš' },
                { word: 'ãŸã¹ã¾ã›ã‚“ã‹', reading: 'ãŸã¹ã¾ã›ã‚“ã‹', romaji: 'Tabemasenka', accent: 0, english: 'Won\'t you eat?', emoji: 'ğŸ½ï¸' },
                { word: 'ã„ã„ã§ã™ã­', reading: 'ã„ã„ã§ã™ã­', romaji: 'Ii desune', accent: 1, english: 'That sounds good', emoji: 'ğŸ‘' },
                { word: 'ã„ã¤', reading: 'ã„ã¤', romaji: 'Itsu', accent: 1, english: 'When', emoji: 'ğŸ“…' },
                { word: 'ã«ã¡ã‚ˆã†ã³', reading: 'ã«ã¡ã‚ˆã†ã³', romaji: 'Nichiyoubi', accent: 3, english: 'Sunday', emoji: 'ğŸ”´' },
                { word: 'ã©ã‚ˆã†ã³', reading: 'ã©ã‚ˆã†ã³', romaji: 'Doyoubi', accent: 2, english: 'Saturday', emoji: 'ğŸ”µ' },
                { word: 'ã‚‰ã„ã—ã‚…ã†', reading: 'ã‚‰ã„ã—ã‚…ã†', romaji: 'Raishuu', accent: 0, english: 'Next week', emoji: 'â­ï¸' },
                { word: 'ã„ãã¾ã™', reading: 'ã„ãã¾ã™', romaji: 'Ikimasu', accent: 3, english: 'Go', emoji: 'ğŸš¶' },
                { word: 'ã¿ã¾ã›ã‚“ã‹', reading: 'ã¿ã¾ã›ã‚“ã‹', romaji: 'Mimasenka', accent: 0, english: 'Won\'t you watch?', emoji: 'ğŸ‘€' },
                { word: 'ã–ã‚“ã­ã‚“', reading: 'ã–ã‚“ã­ã‚“', romaji: 'Zannen', accent: 3, english: 'Regrettable / Sorry', emoji: 'ğŸ˜¢' },
                { word: 'ã¾ãŸ ã“ã‚“ã©', reading: 'ã¾ãŸ ã“ã‚“ã©', romaji: 'Mata kondo', accent: 1, english: 'Another time', emoji: 'ğŸ‘‹' }
            ],
            '13': [
                { word: 'ãˆã', reading: 'ãˆã', romaji: 'Eki', accent: 1, english: 'Station', emoji: 'ğŸš‰' },
                { word: 'ãƒã‚¹', reading: 'ãƒã‚¹', romaji: 'Basu', accent: 1, english: 'Bus', emoji: 'ğŸšŒ' },
                { word: 'ã§ã‚“ã—ã‚ƒ', reading: 'ã§ã‚“ã—ã‚ƒ', romaji: 'Densha', accent: 0, english: 'Train', emoji: 'ğŸšƒ' },
                { word: 'ã¡ã‹ã¦ã¤', reading: 'ã¡ã‹ã¦ã¤', romaji: 'Chikatetsu', accent: 0, english: 'Subway', emoji: 'ğŸš‡' },
                { word: 'ã˜ã¦ã‚“ã—ã‚ƒ', reading: 'ã˜ã¦ã‚“ã—ã‚ƒ', romaji: 'Jitensha', accent: 0, english: 'Bicycle', emoji: 'ğŸš²' },
                { word: 'ã‚¿ã‚¯ã‚·ãƒ¼', reading: 'ã‚¿ã‚¯ã‚·ãƒ¼', romaji: 'Takushii', accent: 1, english: 'Taxi', emoji: 'ğŸš•' },
                { word: 'ã‚ã‚‹ã„ã¦', reading: 'ã‚ã‚‹ã„ã¦', romaji: 'Aruite', accent: 2, english: 'On foot / Walking', emoji: 'ğŸš¶' },
                { word: 'ãªã‚“ã·ã‚“', reading: 'ãªã‚“ã·ã‚“', romaji: 'Nanpun', accent: 1, english: 'How many minutes', emoji: 'â±ï¸' },
                { word: 'ãã‚‰ã„', reading: 'ãã‚‰ã„', romaji: 'Kurai', accent: 0, english: 'About / Approximately', emoji: 'â‰ˆ' },
                { word: 'ã©ã†ã‚„ã£ã¦', reading: 'ã©ã†ã‚„ã£ã¦', romaji: 'Douyatte', accent: 1, english: 'How (by what means)', emoji: 'ğŸ—ºï¸' }
            ],
            '14': [
                { word: 'ã¾ã¡', reading: 'ã¾ã¡', romaji: 'Machi', accent: 2, english: 'Town / City', emoji: 'ğŸ™ï¸' },
                { word: 'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³', reading: 'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³', romaji: 'Resutoran', accent: 0, english: 'Restaurant', emoji: 'ğŸ´' },
                { word: 'ã‚¹ãƒ¼ãƒ‘ãƒ¼', reading: 'ã‚¹ãƒ¼ãƒ‘ãƒ¼', romaji: 'Suupaa', accent: 1, english: 'Supermarket', emoji: 'ğŸ›’' },
                { word: 'ã‚³ãƒ³ãƒ“ãƒ‹', reading: 'ã‚³ãƒ³ãƒ“ãƒ‹', romaji: 'Konbini', accent: 0, english: 'Convenience store', emoji: 'ğŸª' },
                { word: 'ã³ã‚‡ã†ã„ã‚“', reading: 'ã³ã‚‡ã†ã„ã‚“', romaji: 'Byouin', accent: 0, english: 'Hospital', emoji: 'ğŸ¥' },
                { word: 'ã‚†ã†ã³ã‚“ãã‚‡ã', reading: 'ã‚†ã†ã³ã‚“ãã‚‡ã', romaji: 'Yuubinkyoku', accent: 3, english: 'Post office', emoji: 'ğŸ“®' },
                { word: 'ãŠãŠãã„', reading: 'ãŠãŠãã„', romaji: 'Ookii', accent: 3, english: 'Big', emoji: 'ğŸ˜' },
                { word: 'ã¡ã„ã•ã„', reading: 'ã¡ã„ã•ã„', romaji: 'Chiisai', accent: 3, english: 'Small', emoji: 'ğŸœ' },
                { word: 'ã¡ã‹ã„', reading: 'ã¡ã‹ã„', romaji: 'Chikai', accent: 2, english: 'Near', emoji: 'ğŸš¶' },
                { word: 'ã¨ãŠã„', reading: 'ã¨ãŠã„', romaji: 'Tooi', accent: 0, english: 'Far', emoji: 'ğŸ”­' },
                { word: 'ã¹ã‚“ã‚Š', reading: 'ã¹ã‚“ã‚Š', romaji: 'Benri', accent: 1, english: 'Convenient', emoji: 'ğŸ‘' },
                { word: 'ã«ãã‚„ã‹', reading: 'ã«ãã‚„ã‹', romaji: 'Nigiyaka', accent: 2, english: 'Lively / Busy', emoji: 'ğŸ‰' },
                { word: 'ã—ãšã‹', reading: 'ã—ãšã‹', romaji: 'Shizuka', accent: 1, english: 'Quiet', emoji: 'ğŸ¤«' }
            ],
            '15': [
                { word: 'ã‚·ãƒ£ãƒ„', reading: 'ã‚·ãƒ£ãƒ„', romaji: 'Shatsu', accent: 1, english: 'Shirt', emoji: 'ğŸ‘”' },
                { word: 'Tã‚·ãƒ£ãƒ„', reading: 'ãƒ†ã‚£ãƒ¼ã‚·ãƒ£ãƒ„', romaji: 'Tiishatsu', accent: 3, english: 'T-shirt', emoji: 'ğŸ‘•' },
                { word: 'ã‚³ãƒ¼ãƒˆ', reading: 'ã‚³ãƒ¼ãƒˆ', romaji: 'Kooto', accent: 1, english: 'Coat', emoji: 'ğŸ§¥' },
                { word: 'ãã¤', reading: 'ãã¤', romaji: 'Kutsu', accent: 2, english: 'Shoes', emoji: 'ğŸ‘' },
                { word: 'ã‹ã°ã‚“', reading: 'ã‹ã°ã‚“', romaji: 'Kaban', accent: 0, english: 'Bag', emoji: 'ğŸ‘œ' },
                { word: 'ã¼ã†ã—', reading: 'ã¼ã†ã—', romaji: 'Boushi', accent: 0, english: 'Hat', emoji: 'ğŸ§¢' },
                { word: 'ã“ã‚Œ', reading: 'ã“ã‚Œ', romaji: 'Kore', accent: 0, english: 'This one', emoji: 'ğŸ‘‡' },
                { word: 'ãã‚Œ', reading: 'ãã‚Œ', romaji: 'Sore', accent: 0, english: 'That one', emoji: 'ğŸ‘‰' },
                { word: 'ã‚ã‚Œ', reading: 'ã‚ã‚Œ', romaji: 'Are', accent: 0, english: 'That one over there', emoji: 'ğŸ‘‰' },
                { word: 'ã„ãã‚‰', reading: 'ã„ãã‚‰', romaji: 'Ikura', accent: 1, english: 'How much', emoji: 'ğŸ’°' }
            ],
            '16': [
                { word: 'ãˆã‚“', reading: 'ãˆã‚“', romaji: 'En', accent: 1, english: 'Yen', emoji: 'ğŸ’´' },
                { word: 'ã²ã‚ƒã', reading: 'ã²ã‚ƒã', romaji: 'Hyaku', accent: 2, english: 'Hundred', emoji: '1ï¸âƒ£0ï¸âƒ£0ï¸âƒ£' },
                { word: 'ã›ã‚“', reading: 'ã›ã‚“', romaji: 'Sen', accent: 1, english: 'Thousand', emoji: '1ï¸âƒ£K' },
                { word: 'ã¾ã‚“', reading: 'ã¾ã‚“', romaji: 'Man', accent: 1, english: 'Ten thousand', emoji: '1ï¸âƒ£0ï¸âƒ£K' },
                { word: 'ã‹ã„ã‚‚ã®', reading: 'ã‹ã„ã‚‚ã®', romaji: 'Kaimono', accent: 0, english: 'Shopping', emoji: 'ğŸ›ï¸' },
                { word: 'ã‹ã„ã‘ã„', reading: 'ã‹ã„ã‘ã„', romaji: 'Kaikei', accent: 0, english: 'Checkout / Bill', emoji: 'ğŸ§¾' },
                { word: 'ã‚«ãƒ¼ãƒ‰', reading: 'ã‚«ãƒ¼ãƒ‰', romaji: 'Kaado', accent: 1, english: 'Card', emoji: 'ğŸ’³' },
                { word: 'ã’ã‚“ãã‚“', reading: 'ã’ã‚“ãã‚“', romaji: 'Genkin', accent: 3, english: 'Cash', emoji: 'ğŸ’µ' },
                { word: 'ãƒ¬ã‚·ãƒ¼ãƒˆ', reading: 'ãƒ¬ã‚·ãƒ¼ãƒˆ', romaji: 'Reshiito', accent: 2, english: 'Receipt', emoji: 'ğŸ“ƒ' },
                { word: 'ãµãã‚', reading: 'ãµãã‚', romaji: 'Fukuro', accent: 3, english: 'Bag (plastic/shopping)', emoji: 'ğŸ›ï¸' },
                { word: 'ã„ã‚Šã¾ã›ã‚“', reading: 'ã„ã‚Šã¾ã›ã‚“', romaji: 'Irimasen', accent: 4, english: 'I don\'t need it', emoji: 'ğŸ‘‹' }
            ],
            '17': [
                { word: 'ã—ã‚…ã†ã¾ã¤', reading: 'ã—ã‚…ã†ã¾ã¤', romaji: 'Shuumatsu', accent: 0, english: 'Weekend', emoji: 'ğŸ“…' },
                { word: 'ãªã«ã‚‚', reading: 'ãªã«ã‚‚', romaji: 'Nanimo', accent: 1, english: 'Nothing', emoji: 'ğŸ™…' },
                { word: 'ã—ã¾ã›ã‚“ã§ã—ãŸ', reading: 'ã—ã¾ã›ã‚“ã§ã—ãŸ', romaji: 'Shimasen deshita', accent: 0, english: 'Did not do', emoji: 'ğŸ›Œ' },
                { word: 'ãã†ã˜', reading: 'ãã†ã˜', romaji: 'Souji', accent: 1, english: 'Cleaning', emoji: 'ğŸ§¹' },
                { word: 'ã›ã‚“ãŸã', reading: 'ã›ã‚“ãŸã', romaji: 'Sentaku', accent: 0, english: 'Laundry', emoji: 'ğŸ§º' },
                { word: 'ã•ã‚“ã½', reading: 'ã•ã‚“ã½', romaji: 'Sanpo', accent: 0, english: 'Walk / Stroll', emoji: 'ğŸš¶' },
                { word: 'ã“ã†ãˆã‚“', reading: 'ã“ã†ãˆã‚“', romaji: 'Kouen', accent: 0, english: 'Park', emoji: 'ğŸŒ³' },
                { word: 'ã©ã†ã§ã—ãŸã‹', reading: 'ã©ã†ã§ã—ãŸã‹', romaji: 'Dou deshitaka', accent: 1, english: 'How was it?', emoji: 'ğŸ¤”' },
                { word: 'ãŸã®ã—ã‹ã£ãŸ', reading: 'ãŸã®ã—ã‹ã£ãŸ', romaji: 'Tanoshikatta', accent: 3, english: 'Was fun', emoji: 'ğŸ˜„' },
                { word: 'ãŸã„ã¸ã‚“', reading: 'ãŸã„ã¸ã‚“', romaji: 'Taihen', accent: 0, english: 'Tough / Hard', emoji: 'ğŸ˜“' },
                { word: 'ã‚†ã£ãã‚Š', reading: 'ã‚†ã£ãã‚Š', romaji: 'Yukkuri', accent: 3, english: 'Relaxing / Slowly', emoji: 'ğŸµ' }
            ],
            '18': [
                { word: 'ã‚„ã™ã¿', reading: 'ã‚„ã™ã¿', romaji: 'Yasumi', accent: 3, english: 'Holiday / Break', emoji: 'ğŸ–ï¸' },
                { word: 'ã‚Šã‚‡ã“ã†', reading: 'ã‚Šã‚‡ã“ã†', romaji: 'Ryokou', accent: 0, english: 'Travel', emoji: 'âœˆï¸' },
                { word: 'ãŠã‚“ã›ã‚“', reading: 'ãŠã‚“ã›ã‚“', romaji: 'Onsen', accent: 0, english: 'Hot spring', emoji: 'â™¨ï¸' },
                { word: 'ãŠã¿ã‚„ã’', reading: 'ãŠã¿ã‚„ã’', romaji: 'Omiyage', accent: 0, english: 'Souvenir', emoji: 'ğŸ' },
                { word: 'ã—ã‚ƒã—ã‚“', reading: 'ã—ã‚ƒã—ã‚“', romaji: 'Shashin', accent: 0, english: 'Photo', emoji: 'ğŸ“¸' },
                { word: 'ã¨ã‚Šã¾ã™', reading: 'ã¨ã‚Šã¾ã™', romaji: 'Torimasu', accent: 3, english: 'Take (a photo)', emoji: 'ğŸ¤³' },
                { word: 'ã‚„ã¾', reading: 'ã‚„ã¾', romaji: 'Yama', accent: 2, english: 'Mountain', emoji: 'â›°ï¸' },
                { word: 'ã‹ã‚', reading: 'ã‹ã‚', romaji: 'Kawa', accent: 2, english: 'River', emoji: 'ğŸï¸' },
                { word: 'ã¾ãŸ', reading: 'ã¾ãŸ', romaji: 'Mata', accent: 0, english: 'Again', emoji: 'ğŸ”„' },
                { word: 'ã„ããŸã„', reading: 'ã„ããŸã„', romaji: 'Ikitai', accent: 3, english: 'Want to go', emoji: 'ğŸ¤©' }
            ]
        };

        const quizApp = {
            currentQuestions: [],
            wrongQuestions: [],
            currentIndex: 0,
            score: 0,
            availableVoices: [],
            selectedVoiceIndex: 0,
            speechRate: 0.8,
            allWords: [], 

            init() {
                this.loadVoices();
                if (speechSynthesis.onvoiceschanged !== undefined) {
                    speechSynthesis.onvoiceschanged = this.loadVoices.bind(this);
                }
                
                // Collect all words into a single pool for distractors
                this.allWords = [];
                Object.values(vocabData).forEach(lessonWords => {
                    this.allWords.push(...lessonWords);
                });

                // Settings Listeners
                document.getElementById('rate-range').addEventListener('input', (e) => {
                    this.speechRate = parseFloat(e.target.value);
                    document.getElementById('rate-val').textContent = this.speechRate;
                });
                document.getElementById('voice-select').addEventListener('change', (e) => {
                    this.selectedVoiceIndex = parseInt(e.target.value);
                });

                this.renderMenu();
            },

            loadVoices() {
                const voices = window.speechSynthesis.getVoices();
                this.availableVoices = voices.filter(voice => voice.lang.includes('ja') || voice.lang.includes('JP'));
                
                this.availableVoices.sort((a, b) => {
                    const isBetterA = a.name.includes('Google') || a.name.includes('Microsoft') || a.name.includes('Siri');
                    const isBetterB = b.name.includes('Google') || b.name.includes('Microsoft') || b.name.includes('Siri');
                    return isBetterB - isBetterA;
                });

                const select = document.getElementById('voice-select');
                if (select) {
                    select.innerHTML = '';
                    if (this.availableVoices.length === 0) {
                        const opt = document.createElement('option');
                        opt.text = "æ—¥æœ¬èªéŸ³å£°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“";
                        select.add(opt);
                    } else {
                        this.availableVoices.forEach((voice, index) => {
                            const opt = document.createElement('option');
                            opt.value = index;
                            opt.text = `${voice.name} (${voice.lang})`;
                            select.add(opt);
                        });
                        select.value = this.selectedVoiceIndex;
                    }
                }
            },

            openSettings() {
                this.loadVoices();
                document.getElementById('settings-modal').classList.remove('hidden');
            },

            closeSettings() {
                document.getElementById('settings-modal').classList.add('hidden');
            },

            testSpeech() {
                this.speak('ã“ã‚“ã«ã¡ã¯ã€‚ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆã§ã™ã€‚');
            },

            shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            },
            
            getDistractors(correctWord) {
                const distractors = [];
                const targetLength = correctWord.length;
                
                let candidatePool = this.allWords.filter(w => 
                    w.reading !== correctWord && 
                    Math.abs(w.reading.length - targetLength) <= 1
                );
                
                if (candidatePool.length < 5) {
                    candidatePool = this.allWords.filter(w => w.reading !== correctWord);
                }

                while(distractors.length < 3) {
                    if (candidatePool.length === 0) break; 
                    
                    const randIndex = Math.floor(Math.random() * candidatePool.length);
                    const r = candidatePool[randIndex].reading;
                    
                    if (!distractors.includes(r)) {
                        distractors.push(r);
                    }
                    candidatePool.splice(randIndex, 1);
                }
                return distractors;
            },

            getMoras(text) {
                return text.match(/[ã‚¡-ãƒ´ãƒ¼ã-ã‚“äºœ-ç†™][ã‚¡ã‚£ã‚¥ã‚§ã‚©ãƒ£ãƒ¥ãƒ§ãƒ®ã£]?/g) || [text];
            },

            speak(text) {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'ja-JP';
                    utterance.rate = this.speechRate;

                    if (this.availableVoices.length > 0 && this.availableVoices[this.selectedVoiceIndex]) {
                        utterance.voice = this.availableVoices[this.selectedVoiceIndex];
                    }
                    window.speechSynthesis.speak(utterance);
                }
            },

            createAccentHTML(text, accentType) {
                const moras = this.getMoras(text);
                let html = '';
                
                moras.forEach((mora, index) => {
                    const i = index + 1;
                    let isHigh = false;
                    let isDrop = false;

                    if (accentType === 0) {
                        if (i > 1) isHigh = true;
                    } else if (accentType === 1) {
                        if (i === 1) { isHigh = true; isDrop = true; }
                    } else {
                        if (i > 1 && i <= accentType) isHigh = true;
                        if (i === accentType) isDrop = true;
                    }

                    let classes = 'mora text-2xl font-bold px-1 ';
                    if (isHigh) classes += 'pitch-high ';
                    else classes += 'pitch-low ';
                    if (isDrop) classes += 'pitch-drop ';

                    html += `<span class="${classes}">${mora}</span>`;
                });
                return html;
            },

            render(templateId) {
                const content = document.getElementById('app-content');
                const tmpl = document.getElementById(templateId);
                content.innerHTML = '';
                content.appendChild(tmpl.content.cloneNode(true));
            },
            
            renderMenu() {
                this.render('tmpl-menu');
                const grid = document.getElementById('lesson-grid');
                
                for (let i = 1; i <= 18; i++) {
                    const btn = document.createElement('button');
                    btn.className = "p-4 rounded-xl border-2 border-sky-100 bg-sky-50 hover:bg-sky-100 hover:border-sky-300 transition-all text-left flex items-center group shadow-sm";
                    btn.onclick = () => this.startQuiz(i.toString());
                    
                    btn.innerHTML = `
                        <span class="bg-sky-500 text-white rounded-full w-8 h-8 flex-shrink-0 flex items-center justify-center mr-3 font-bold group-hover:scale-110 transition-transform shadow-md">${i}</span>
                        <div>
                            <div class="font-bold text-slate-700 text-sm">ç¬¬${i}èª² (L${i})</div>
                        </div>
                    `;
                    grid.appendChild(btn);
                }
            },

            // Helper to get questions for a range
            getQuestionsForRange(start, end) {
                let questions = [];
                for (let i = start; i <= end; i++) {
                    if (vocabData[i.toString()]) {
                        questions.push(...vocabData[i.toString()]);
                    }
                }
                return questions;
            },

            startQuiz(lessonKey) {
                let rawQuestions = [];
                let isReview = false;

                if (lessonKey === 'review-1-6') {
                    rawQuestions = this.getQuestionsForRange(1, 6);
                    isReview = true;
                } else if (lessonKey === 'review-7-12') {
                    rawQuestions = this.getQuestionsForRange(7, 12);
                    isReview = true;
                } else if (lessonKey === 'review-13-18') {
                    rawQuestions = this.getQuestionsForRange(13, 18);
                    isReview = true;
                } else {
                    rawQuestions = vocabData[lessonKey];
                }

                if (!rawQuestions || rawQuestions.length === 0) {
                    alert("ã“ã®èª²ã®ãƒ‡ãƒ¼ã‚¿ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ (Data not found)");
                    return;
                }
                
                // New Quiz: Reset wrong questions
                this.wrongQuestions = [];
                
                // Shuffle raw questions first
                this.shuffle(rawQuestions);

                // If review mode, limit to 30 random questions to keep it manageable
                if (isReview && rawQuestions.length > 30) {
                    rawQuestions = rawQuestions.slice(0, 30);
                }
                
                this.currentQuestions = rawQuestions.map(q => {
                    const dists = this.getDistractors(q.reading);
                    
                    const options = this.shuffle([
                        { text: q.reading, isCorrect: true, accent: q.accent, romaji: q.romaji },
                        { text: dists[0], isCorrect: false },
                        { text: dists[1], isCorrect: false },
                        { text: dists[2], isCorrect: false }
                    ]);
                    return { ...q, options };
                });
                
                this.currentIndex = 0;
                this.score = 0;
                this.renderQuestion();
            },

            retryWrong() {
                if (this.wrongQuestions.length === 0) return;
                
                this.currentQuestions = this.wrongQuestions.map(q => {
                     const dists = this.getDistractors(q.reading);
                    const options = this.shuffle([
                        { text: q.reading, isCorrect: true, accent: q.accent, romaji: q.romaji },
                        { text: dists[0], isCorrect: false },
                        { text: dists[1], isCorrect: false },
                        { text: dists[2], isCorrect: false }
                    ]);
                    return { ...q, options };
                });
                
                this.wrongQuestions = []; 
                this.shuffle(this.currentQuestions);
                this.currentIndex = 0;
                this.score = 0;
                this.renderQuestion();
            },

            renderQuestion() {
                this.render('tmpl-question');
                const q = this.currentQuestions[this.currentIndex];
                const total = this.currentQuestions.length;
                
                const progressPct = ((this.currentIndex) / total) * 100;
                document.getElementById('progress-bar').style.width = `${progressPct}%`;
                
                document.getElementById('q-image').textContent = q.emoji;
                document.getElementById('q-hint').textContent = q.english;
                
                const optionsContainer = document.getElementById('options-container');
                q.options.forEach(opt => {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'flex items-center gap-2';

                    const voiceBtn = document.createElement('button');
                    voiceBtn.className = 'btn-play w-12 h-12 rounded-full bg-sky-100 text-sky-500 flex items-center justify-center flex-shrink-0 shadow-sm border border-sky-200';
                    voiceBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z" /></svg>';
                    voiceBtn.title = "å£°ã‚’èã";
                    voiceBtn.onclick = () => this.speak(opt.text);

                    const answerBtn = document.createElement('button');
                    answerBtn.className = 'btn-answer flex-1 bg-white border-2 border-slate-200 text-slate-700 font-bold py-3 px-4 rounded-xl text-lg transition-all shadow-sm';
                    answerBtn.textContent = opt.text;
                    answerBtn.onclick = () => this.checkAnswer(opt, q, answerBtn);
                    
                    wrapper.appendChild(voiceBtn);
                    wrapper.appendChild(answerBtn);
                    optionsContainer.appendChild(wrapper);
                });
            },

            checkAnswer(selectedOpt, questionData, btnElement) {
                const buttons = document.querySelectorAll('button');
                buttons.forEach(b => b.disabled = true);

                const feedbackArea = document.getElementById('feedback-area');
                const feedbackIcon = document.getElementById('feedback-icon');
                const feedbackText = document.getElementById('feedback-text');
                const feedbackCorrect = document.getElementById('feedback-correct-answer');
                const feedbackRomaji = document.getElementById('feedback-romaji');

                const isCorrect = selectedOpt.text === questionData.reading;

                if (isCorrect) {
                    this.score++;
                    btnElement.classList.add('correct-anim');
                    feedbackIcon.textContent = 'â­•';
                    feedbackText.textContent = 'ã›ã„ã‹ã„ï¼';
                    feedbackText.className = 'text-4xl font-bold mb-2 text-green-500';
                } else {
                    btnElement.classList.add('wrong-anim');
                    feedbackIcon.textContent = 'âŒ';
                    feedbackText.textContent = 'ã–ã‚“ã­ã‚“...';
                    feedbackText.className = 'text-4xl font-bold mb-2 text-red-500';
                    
                    this.wrongQuestions.push(questionData);
                }

                feedbackCorrect.innerHTML = this.createAccentHTML(questionData.reading, questionData.accent);
                feedbackRomaji.textContent = questionData.romaji;
                feedbackArea.classList.remove('hidden');

                setTimeout(() => {
                    this.speak(questionData.reading);
                }, 300);

                feedbackArea.querySelector('button').disabled = false;
            },

            nextQuestion() {
                this.currentIndex++;
                if (this.currentIndex < this.currentQuestions.length) {
                    this.renderQuestion();
                } else {
                    this.showResult();
                }
            },

            showResult() {
                this.render('tmpl-result');
                const total = this.currentQuestions.length;
                document.getElementById('score-num').textContent = this.score;
                document.getElementById('total-num').textContent = total;
                
                const msg = document.getElementById('score-message');
                const percentage = this.score / total;
                
                if (percentage === 1) {
                    msg.textContent = 'ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼ (Perfect!)';
                } else if (percentage >= 0.8) {
                    msg.textContent = 'ã™ã”ã„ï¼ (Great!)';
                } else if (percentage >= 0.5) {
                    msg.textContent = 'ã‚ã¨ã™ã“ã—ï¼ (Good job!)';
                } else {
                    msg.textContent = 'ã‚‚ã†ã„ã¡ã© ãŒã‚“ã°ã‚ã†ï¼ (Try again!)';
                }
                
                if (this.wrongQuestions.length > 0) {
                    document.getElementById('retry-container').classList.remove('hidden');
                }
            }
        };

        window.addEventListener('load', () => {
            quizApp.init();
        });
    </script>
</body>
</html>